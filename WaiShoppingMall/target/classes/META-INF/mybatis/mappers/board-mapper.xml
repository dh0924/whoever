<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.test.imsi.board-mapper">


	<select id="productAllNum" resultType="int" parameterType="String">
      Select count(productcode) 
      From producttable
      Where rowid in (select max(rowid) from producttable group by productsubject)
   </select>
   
   <select id="productgenderNum" resultType="int" parameterType="hashmap">
      Select count(productcode) 
      From producttable
      Where productcategory = #{productcategory} And (productgender = #{productgender} Or productgender = 'unisex') And rowid in (select max(rowid) from producttable group by productsubject)
   </select>
<select id="productSearchNum" resultType="int" parameterType="String">
		Select count(productcode) 
		From producttable
		Where productsubject like '%' || #{searchProduct} || '%' And rowid in (select max(rowid) from producttable group by productsubject)
	</select>

<select id="productSearchPaging" resultType="product" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From producttable
			        Where 
			        <if test="searchProduct != ''">
			        	productsubject like '%' || #{searchProduct} || '%' and
			        </if>
			        	rowid in (select max(rowid) from producttable group by productsubject)
					<choose>
						<when test="viewmethod == 'productdate'">
							order by productdate desc	
						</when>
						<when test="viewmethod == 'productpriceup'">
							order by productprice desc	
						</when>
						<when test="viewmethod == 'productpricedown'">
							order by productprice	
						</when>
					</choose>
					) Q 
		<choose>
			<when test="(((page-1)*6)+6) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*6)+6 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*6)+1
	</select>
<select id="productgenderPaging" resultType="product" parameterType="hashmap">
      Select *
      From (Select Q.* , rownum as R 
           From (Select * 
                 From producttable
                 Where productcategory = #{productcategory} And (productgender = #{productgender} or productgender = 'unisex') And rowid in (select max(rowid) from producttable group by productsubject)
               <choose>
                  <when test="viewmethod == 'productdate'">
                     order by productdate desc   
                  </when>
                  <when test="viewmethod == 'productpriceup'">
                     order by productprice desc   
                  </when>
                  <when test="viewmethod == 'productpricedown'">
                     order by productprice   
                  </when>
               </choose>
               ) Q 
      <choose>
         <when test="(((page-1)*6)+6) > totalnum">
            <![CDATA[Where rownum <= #{totalnum} ]]>   
         </when>
         <otherwise>
            <![CDATA[Where rownum <= ((#{page}-1)*6)+6 ]]>
         </otherwise>
      </choose>
         )
      Where R >= ((#{page}-1)*6)+1
   </select>
	<!-- 장바구니 -->
	<insert id="cartInsert" parameterType="cart">
      Insert into cart
      Values (#{cartno} , #{id} , #{productsubject} , #{productcolor} , #{productsize} , #{productprice} , #{productamount} , #{stored_fname}) 
   </insert>
      <select id="cartView" resultType="cart" parameterType="String">
      Select *
      From cart
      Where id = #{id} 
   </select>
   
   <delete id="cartDelete" parameterType="hashmap">
      Delete from cart
      Where id = #{id} and cartno = #{cartno}
   </delete>
   <select id="cartMaxNum" resultType="int">
      Select max(cartno)
      From cart
      </select>
         <!-- 여기서부터 주문 내역관련 -->
<select id="orderhistoryNum" resultType="int">
      Select count(orderno)
      From orderhistory
      Where orderstate = '배송 준비 중'
      </select>
<select id="orderhistoryMyNum" resultType="int" parameterType="String">
      Select count(orderno)
      From orderhistory
      Where id = #{id}
   </select>
      <select id="orderhistoryMyList" resultType="orderhistory" parameterType="String">
   Select orderno , id , productsubject , productcolor , productsize , productprice , productamount , stored_fname , orderstate , to_char(orderdate,'YYYY-MM-DD') AS orderdate 
   From (Select Q.* , rownum 
          From orderhistory Q
          Where id = #{id} <![CDATA[ And rownum <= 5 ]]>
          order by orderdate desc) 
   </select>

   <select id="orderhistoryPaing" resultType="orderhistory" parameterType="hashmap">
      Select *
      From (Select Q.* , rownum as R 
           From (Select * 
                 From orderhistory Where orderstate = '배송 준비 중' order by orderno desc) Q 
      <choose>
         <when test="(((page-1)*10)+10) > totalnum">
            <![CDATA[Where rownum <= #{totalnum} ]]>   
         </when>
         <otherwise>
            <![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
         </otherwise>
      </choose>
         )
      Where R >= ((#{page}-1)*10)+1
   </select>


   <select id="orderhistoryAllNum" resultType="int">
      Select count(orderno)
      From orderhistory
      Where orderstate = '배송 완료' or orderstate = '리뷰 작성 완료'
   </select>
   
   <select id="orderhistorySearchNum" resultType="int">
      Select count(orderno)
      From orderhistory
      Where id like '%' || #{searchID} || '%' and (orderstate = '배송 완료' or orderstate = '리뷰 작성 완료')
   </select>

	<update id="orderhistoryUpdate" parameterType="int">
      Update orderhistory
      Set orderstate = '배송 완료'
      Where orderno = #{orderno}
   </update>
   
   <update id="productUpdatePic" parameterType="product">
      Update producttable
      Set productstock = #{productstock} , productgender = #{productgender} , productprice = #{productprice} , productsubject = #{productsubject} , productcontents = #{productcontents} , original_fname = #{original_fname} , stored_fname = #{stored_fname}
      Where productcode = #{productcode}
   </update> 
   
   <update id="uploadReview" parameterType="int">
      Update orderhistory
      Set orderstate = '리뷰 작성 완료'
      Where orderno = #{orderno}
   </update>
   
     <select id="orderhistoryCheckPaing" resultType="orderhistory" parameterType="hashmap">
      Select *
      From (Select Q.* , rownum as R 
           From (Select * 
                 From orderhistory Where
                 <if test="searchID != ''">
			      id like '%' || #{searchID} || '%' and
			     </if>
                 orderstate like '%완료' order by orderno desc) Q 
      <choose>
         <when test="(((page-1)*10)+10) > totalnum">
            <![CDATA[Where rownum <= #{totalnum} ]]>   
         </when>
         <otherwise>
            <![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
         </otherwise>
      </choose>
         )
      Where R >= ((#{page}-1)*10)+1
   </select>
   
      <insert id="orderhistoryInsert" parameterType="orderhistory">
      Insert into orderhistory
      Values (#{orderno} , #{id} , #{productsubject} , #{productcolor} , #{productsize} , #{productprice} , #{productamount} , #{stored_fname} , #{orderstate}, #{orderdate}) 
   </insert>
   
     <delete id="orderhistoryDelete" parameterType="int">
      Delete From orderhistory
      Where orderno = #{orderno}
   </delete>
   
      <select id="orderhistoryMaxNum" resultType="int">
      Select max(orderno)
      From orderhistory
      </select>
   
   
     <select id="orderhistoryMyPaing" resultType="orderhistory" parameterType="hashmap">
      Select orderno , id , productsubject , productcolor , productsize , productprice , productamount , stored_fname , orderstate , to_char(orderdate,'YYYY-MM-DD') AS orderdate
      From (Select Q.* , rownum as R 
           From (Select * 
                 From orderhistory Where id = #{id} order by orderno desc) Q 
      <choose>
         <when test="(((page-1)*10)+10) > totalnum">
            <![CDATA[Where rownum <= #{totalnum} ]]>   
         </when>
         <otherwise>
            <![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
         </otherwise>
      </choose>
         )
      Where R >= ((#{page}-1)*10)+1
   </select>
      
      
      <select id="productMapping" resultType="String" parameterType="product">
      Select productcode
      From producttable
      Where productsubject = #{productsubject} and productsize = #{productsize} and productcolor = #{productcolor}
   </select>
 
	<!-- 여기서부터 QNA -->
	<update id="qnaboardModify" parameterType="qnaboard">
      Update qnaboard
      Set qnakind = #{qnakind} , qnasubject = #{qnasubject} , qnacontents = #{qnacontents} , qnalock = #{qnalock}
      Where qnano = #{qnano}
   </update>
   
	<select id="qnaboardAllData" resultType="qnaboard">
		Select qnano,qnakind,qnasubject,to_char(qnadate,'YYYY-MM-DD') AS qnadate,qnalock,qnaanswer,memberid 
		From qnaboard
		Order by qnano desc
	</select>
	
	<select id="qnaboardNum" resultType="int" parameterType="String">
		Select count(qnano) 
		From qnaboard
		Where productcode = #{productcode}
	</select>
	
	<select id="qnaboardNum1" resultType="int" >
		Select count(qnano) 
		From qnaboard
	</select>
	
	<select id="qnaboardSearchNum" resultType="int">
      Select count(qnano)
      From qnaboard
      Where memberid like '%' || #{searchID} || '%'
   </select>

<select id="qnaboardPaging2" resultType="qnaboard" parameterType="hashmap">
      Select qnano,qnakind,qnasubject,qnacontents,to_char(qnadate,'YYYY-MM-DD') AS qnadate,qnalock,qnaanswer,memberid,productcode,qnaanswercontents
      From (Select Q.* , rownum as R 
           From (Select * 
                 From qnaboard
                 <if test="searchID != ''">
			     	Where memberid like '%' || #{searchID} || '%'
			     </if>
                 order by qnano desc) Q 
      <choose>
         <when test="(((page-1)*10)+10) > totalnum">
            <![CDATA[Where rownum <= #{totalnum} ]]>   
         </when>
         <otherwise>
            <![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
         </otherwise>
      </choose>
         )
      Where R >= ((#{page}-1)*10)+1
   </select>

   	<select id="qnaboardPaing" resultType="qnaboard" parameterType="hashmap">
		Select qnano,qnakind,qnasubject,qnacontents,to_char(qnadate,'YYYY-MM-DD') AS qnadate,qnalock,qnaanswer,memberid,productcode,qnaanswercontents
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From qnaboard Where productcode = #{productcode} order by qnano desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	
	<select id="qnaboardPaing1" resultType="qnaboard" parameterType="hashmap">
		Select qnano,qnakind,qnasubject,qnacontents,to_char(qnadate,'YYYY-MM-DD') AS qnadate,qnalock,qnaanswer,memberid,productcode,qnaanswercontents
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From qnaboard order by qnano desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	<select id="qnaboardSearchData" resultType="qnaboard" parameterType="int">
      Select qnano , qnakind , qnasubject , qnacontents , productcode , qnaanswercontents , qnalock
      From qnaboard
      Where qnano = #{qnano}
   </select>
	   <select id="qnaboardMyPaing" resultType="qnaboard" parameterType="hashmap">
      Select *
      From (Select Q.* , rownum as R 
           From (Select * 
                 From qnaboard Where memberid = #{memberid} order by qnano desc) Q 
      <choose>
         <when test="(((page-1)*10)+10) > totalnum">
            <![CDATA[Where rownum <= #{totalnum} ]]>   
         </when>
         <otherwise>
            <![CDATA[Where rownum <= ((#{page}-1)*15)+15 ]]>
         </otherwise>
      </choose>
         )
      Where R >= ((#{page}-1)*15)+1
   </select>
   
   <select id="qnaboardMyNum" resultType="int" parameterType="String">
      Select count(qnano) 
      From qnaboard
      Where memberid = #{memberid}
   </select>
	
	<select id="qnaboardMaxNum" resultType="int">
		Select max(qnano)
		From qnaboard
	</select>
	
	<insert id="qnaboardInsert" parameterType="qnaboard">
		Insert into qnaboard (QNANO,QNAKIND,QNASUBJECT,QNACONTENTS,QNADATE,QNALOCK,QNAANSWER,MEMBERID,PRODUCTCODE,QNAANSWERCONTENTS)
		Values (#{qnano} , #{qnakind} , #{qnasubject} , #{qnacontents} , #{qnadate} , #{qnalock} , #{qnaanswer} , #{memberid} , #{productcode} , #{qnaanswercontents}) 
	</insert>
	
	<delete id="qnaboardDelete" parameterType="int">
		Delete From qnaboard
		Where qnano = #{qnano}
	</delete>
	
	<update id="qnaboardUpdate" parameterType="qnaboard">
		Update qnaboard
		Set qnaanswer = 1 , qnaanswercontents = #{qnaanswercontents}
		Where qnano = #{qnano}
	</update>
	
	<!-- 여기서부터 공지사항 -->
	
	<select id="noticeboardAllData" resultType="noticeboard">
		Select noticeno,noticesubject,to_char(noticedate,'YYYY-MM-DD') AS noticedate 
		From noticeboard
		Order by noticeno desc
	</select>
	
	<select id="noticeboardNum" resultType="int">
		Select count(noticeno) 
		From noticeboard
	</select>
	
	<select id="noticeboardPaing" resultType="noticeboard" parameterType="hashmap">
		Select noticeno,noticesubject, noticeid, to_char(noticedate,'YYYY-MM-DD') AS noticedate 
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From noticeboard order by noticeno desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	<select id="noticeboardViewData" resultType="noticeboard" parameterType="int">
		Select noticeno , noticesubject , noticecontents, noticeid, to_char(noticedate,'YYYY-MM-DD') AS noticedate 
		From noticeboard
		Where noticeno = #{noticeno}
	</select>
	
	<delete id="noticeboardDeleteData" parameterType="int">
		Delete From noticeboard
		Where noticeno = #{noticeno}
	</delete>
	
	<select id="noticeboardMaxNum" resultType="int">
		Select max(noticeno)
		From noticeboard
	</select>
	
	<insert id="noticeboardInsert" parameterType="noticeboard">
		Insert into noticeboard (noticeno , noticesubject , noticecontents , noticeid, noticedate)
		Values (#{noticeno} , #{noticesubject} , #{noticecontents} , #{noticeid}, #{noticedate}) 
	</insert>
	
	<update id="noticeboardUpdate" parameterType="noticeboard">
		Update noticeboard
		Set noticesubject = #{noticesubject} , noticecontents = #{noticecontents}
		Where noticeno = #{noticeno}
	</update>
	
	<!-- <select id="qnaboardSearchData" resultType="qnaboard" parameterType="int">
		Select qnano,qnakind,qnasubject,qnacontents,qnadate,qnalock,qnaanswer,memberid,productname
		From qnaboard
		Where qnano = #{qnano}
	</select> -->
	
	<!-- 여기서부터 상품관련 -->
	
	  <select id="mainProductList" resultType="product" parameterType="String">
      Select Q.* , rownum
      From producttable Q
      Where productcategory = #{productcategory} <![CDATA[ And rownum <= 3 ]]> And rowid in (select max(rowid) from producttable group by productsubject) 
      Order by productno desc
   </select>
   
   <select id="productNew" resultType="product">
	Select Q.* , rownum
	From (Select *
			From producttable 
			Where rowid in (select max(rowid) from producttable group by productsubject)
			Order by productno desc) Q
	<![CDATA[ Where rownum <=8 ]]>
   </select>

      
	 <select id="productSameData" resultType="product" parameterType="String">
      Select productsize , productcolor
      From producttable
      Where productsubject = #{productsubject}
   </select>
   
	<select id="productAllData" resultType="product">
		Select * 
		From producttable
	</select>
	
	<select id="productAllNum2" resultType="int" parameterType="String">
		Select count(productcode) 
		From producttable
	</select>
	
	<select id="productSearchNum2" resultType="int" parameterType="String">
		Select count(productcode) 
		From producttable
		Where productsubject like '%' || #{searchProduct} || '%'
	</select>
	
	<select id="productPaing" resultType="product" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From producttable 
			        <if test="searchProduct != ''">
			        	Where productsubject like '%' || #{searchProduct} || '%'
			        </if>
			        order by productno desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	<insert id="productInsert" parameterType="product">
		Insert into producttable 
		Values (#{productno} , #{productcode} , #{productcolor} , #{productsize} , #{productstock} , #{productcategory} , #{productgender} , #{productsubject} , #{productcontents} , #{original_fname} , #{stored_fname} , #{productdate} , #{productstar} , #{productprice}) 
	</insert>
	
	<update id="productUpdate" parameterType="product">
		Update producttable
		Set productstock = #{productstock} , productgender = #{productgender} , productprice = #{productprice} , productsubject = #{productsubject} , productcontents = #{productcontents} 
		Where productcode = #{productcode}
	</update>
	
	<delete id="productDelete" parameterType="String">
		Delete From producttable
		Where productcode = #{productcode}
	</delete>
	
	<select id="productMaxNum" resultType="int">
		Select max(productno)
		From producttable
	</select>
	
	<select id="productViewData" resultType="product" parameterType="String">
		Select * 
		From producttable
		Where productcode = #{productcode}
	</select>
	
	<!-- 여기서부터 리뷰관련 -->
	
	<select id="getStandard" resultType="int" parameterType="int">
      Select r_standard 
      From reviewtable
      Where r_num = #{r_num}
  	 </select>
   
  	 <update id="insertpoint" parameterType="String">	  
  	update login set point = point + 100 
  	where id=#{id}  	
  	</update>
  	
  	<update id="insertapoint" parameterType="String">  
  	update login set a_point = a_point + 100
  	where id=#{id}  	
  	</update> 

	<update id="standard_inc" parameterType="int">
		update reviewtable set r_standard = r_standard+10 where r_num = #{r_num}
	</update>
	
	<select resultType="String" id="checkWriter" parameterType="int">
		select r_writer from reviewtable where r_num=#{r_num}
	</select>
	
	<delete id="reviewtable_delete" parameterType="int">
		delete from reviewtable where r_num = #{r_num}
	</delete>
	
	<delete id="liketable_delete" parameterType="int">
		delete from liketable where r_num = #{r_num}
	</delete>
	
	<select id="getavg" resultType="double" parameterType="String">
      Select avg(r_star) 
      From reviewtable
      Where r_sangpum = #{r_sangpum}
   </select>
   
   <select id="getSangpum" resultType="String" parameterType="String">
      Select productsubject
      From producttable
      Where productcode = #{productcode}
   </select>
   
	<select id="collectpic" resultType="review" parameterType="String">
		select stored_fname, r_num
		from reviewtable
		where r_sangpum = #{r_sangpum} and stored_fname not in ('noFile')
		order by r_num desc
	</select>
	
	<select id="getTotal" resultType="review" parameterType="String">
		select r_star
		from reviewtable
		where r_sangpum = #{r_sangpum}
		order by r_star desc
	</select>
	
	
	<select id="reviewAllData" resultType="review" parameterType="String">
      select r_num,r_grade,r_sangpum,r_size,r_title,r_text,original_fname,stored_fname,r_date,r_writer,r_star,r_good,r_bad,r_check,r_standard
      from reviewtable
      where r_sangpum = #{r_sangpum}
      order by r_num desc
   </select>
	
	<select id="likeAllData" resultType="like" parameterType="String">
		select r_num,like_pic,dislike_pic
		from liketable
		where id1=#{id}
		order by r_num desc
	</select>
	
	<insert id="insertReview" parameterType="review">
		insert into reviewtable (r_num,r_grade,r_sangpum,r_size,r_title,r_text,r_writer,original_fname,stored_fname,r_date,r_star,r_good,r_bad,r_check, r_standard)
		values(#{r_num},#{r_grade},#{r_sangpum},#{r_size},#{r_title},#{r_text},#{r_writer},#{original_fname},#{stored_fname},#{r_date},#{r_star},0,0,0,10)
	</insert> 
	
	<select resultType="int" id="reviewMaxNum">
		Select max(r_num)From reviewtable 
	</select>
	
	<select id="reviewNum" resultType="int" parameterType="String">
      Select count(r_num) 
      From reviewtable
      Where r_sangpum = #{r_sangpum}
   </select>
   
   <select id="reviewNum1" resultType="int">
      Select count(r_num) 
      From reviewtable
   </select>
   
   <select id="mypageNum" resultType="int" parameterType="String">
      Select count(r_num) 
      From reviewtable
      Where r_writer like '%' || #{user} || '%'
   </select>
   
   <select id="reviewPaging" resultType="review" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From reviewtable Where r_writer like '%' || #{user} || '%' order by r_num desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
   
   <select id="reviewPaging10" resultType="review" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From reviewtable order by r_num desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
   
   <select id="reviewPaging1" resultType="review" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From reviewtable Where r_sangpum = #{r_sangpum} order by r_num desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	<select id="reviewPaging2" resultType="review" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From reviewtable Where r_sangpum = #{r_sangpum} order by r_good desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	<select id="reviewPaging3" resultType="review" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From reviewtable Where r_sangpum = #{r_sangpum} order by r_star desc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	<select id="reviewPaging4" resultType="review" parameterType="hashmap">
		Select *
		From (Select Q.* , rownum as R 
			  From (Select * 
			        From reviewtable Where r_sangpum = #{r_sangpum} order by r_star asc) Q 
		<choose>
			<when test="(((page-1)*10)+10) > totalnum">
				<![CDATA[Where rownum <= #{totalnum} ]]>	
			</when>
			<otherwise>
				<![CDATA[Where rownum <= ((#{page}-1)*10)+10 ]]>
			</otherwise>
		</choose>
			)
		Where R >= ((#{page}-1)*10)+1
	</select>
	
	<select resultType="int" id="check" parameterType="hashmap">
		select check_like from liketable where r_num=#{r_num} and id1=#{id}
	</select>
	
	<update id="like_inc" parameterType="int">
		update reviewtable set r_good = r_good+1 where r_num = #{r_num}
	</update> 
	
	<insert id="like_insert" parameterType="like">
		insert into liketable (r_num,id1,check_like)
		values(#{r_num},#{id1},#{check_like})
	</insert>
	
	<update id="like_dec" parameterType="int">
		update reviewtable set r_good = r_good-1 where r_num = #{r_num}
	</update> 
	
	<update id="dislike_inc" parameterType="int">
		update reviewtable set r_bad = r_bad+1 where r_num = #{r_num}
	</update> 
	
	<insert id="dislike_insert" parameterType="like">
		insert into liketable (r_num,id1,check_like)
		values(#{r_num},#{id1},#{check_like})
	</insert>
	
	<update id="dislike_dec" parameterType="int">
		update reviewtable set r_bad = r_bad-1 where r_num = #{r_num}
	</update> 
	
	<delete id="like_delete" parameterType="hashmap">
		delete from liketable where r_num=#{r_num} and id1=#{id}
	</delete>
	
	<select resultType="int" id="count_like" parameterType="int">
		Select r_good From reviewtable where r_num = #{r_num} 
	</select>
	
	<select resultType="int" id="count_dislike" parameterType="int">
		Select r_bad From reviewtable where r_num = #{r_num} 
	</select>
	
	<update id="setZero">
		update reviewtable set r_check = 0
	</update>
	
	<update id="setLikeCheck" parameterType="String">
		update reviewtable set r_check = 1
		where r_num in (select r_num from liketable where id1=#{id1} and check_like = 1)
	</update>
	
	<update id="setDislikeCheck" parameterType="String">
		update reviewtable set r_check = -1
		where r_num in (select r_num from liketable where id1=#{id1} and check_like = -1)
	</update>
	
	   <!-- 여기서부터 업로드관련 -->
     <select id="uploadMaxNum" resultType="int">
      Select max(uno)
      From upload
   	</select>
   
   <insert id="uploadInsert" parameterType="upload">
      Insert into upload 
      Values (#{uno} , #{productcode} , #{original_fname} , #{stored_fname}) 
   </insert>
   
   <select id="uploadData" resultType="upload" parameterType="String">
      Select * 
      From upload
      Where productcode = #{productcode}
   </select>
   
    <delete id="uploadDelete" parameterType="String">
		delete from upload
		where productcode = #{productcode}
	</delete>
	
</mapper>